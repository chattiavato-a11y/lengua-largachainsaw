# wrangler.toml — withered-mouse-9aee (Integrity Gateway + Chat/STT)

name = "withered-mouse-9aee"
main = "src/worker.js"
compatibility_date = "2025-11-01"
workers_dev = true

# Workers AI (env.AI)
[ai]
binding = "AI"

# ---------- KV NAMESPACES ----------

# Required: HMAC nonce replay defense (+ fallback honeypot store)
[[kv_namespaces]]
binding = "OPS_NONCE_KV"        # mint/use replay defense
id = "01d6a01e13b74f939c0cd3e8b4e7f59b"          
# replace with real KV id from dashboard

# Optional: separate honeypot banlist KV.
# If you don’t create this, the worker will reuse OPS_NONCE_KV.
[[kv_namespaces]]
binding = "OPS_BANLIST_KV"      # honeypot IP blocks
id = "bf0f692b2ad540938126f26ae77aa851"

# Optional: if you later add transcript storage in the code.
[[kv_namespaces]]
binding = "OPS_TRANSCRIPTS_KV"  # lightweight transcripts / scan reports
id = "ecd39e37d71b43b8bc26340ad9a27697"

Optional: if this SAME worker ever stores scan artifacts in R2.
[[r2_buckets]]
binding = "OPS_ARTIFACTS_R2"
bucket_name = "ops-artifacts"
# create this bucket in R2 first

# Optional: if this SAME worker ever writes training rows.
[[d1_databases]]
binding = "OPS_TRAINING_DB"
database_name = "ops_training_db"
database_id = "f959249d-fa40-48d9-a832-ff375b56e529"

# ---------- NON-SENSITIVE VARS (in repo) ----------
[vars]
INTEGRITY_REQUIRED   = "true"
INTEGRITY_GATEWAY    = "https://withered-mouse-9aee.grabem-holdem-nuts-right.workers.dev"
INTEGRITY_PROTOCOLS  = "CORS,CSP,OPS-CySec-Core,CISA,NIST,PCI-DSS,SHA-384,SHA-512"
SIG_TTL_SECONDS      = "300"
LLM_MAX_TOKENS       = "500"
ALLOW_WORKERS_DEV    = "true"
ALLOW_DASH           = "false"

# JWK used to derive the canonical channella key
CHANNELLA_EXPECTED_PUB = "{ \"crv\": \"P-256\", \"ext\": true, \"key_ops\": [], \"kty\": \"EC\", \"x\": \"LwrIIZR3AcENpAtpQRQ5DtGo5ML7diFfILRgg5DUCdI\", \"y\": \"ALclNxh3f9sSIZ1xBtsCA8f49Te2XFlCg0pysX1x8P0\" }"
